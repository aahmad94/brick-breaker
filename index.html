<!DOCTYPE html>
<html lang="en">
    <head>
        <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
        <meta content="utf-8" http-equiv="encoding">
    </head>
    <body>
        <canvas id="gameCanvas" width="800" height="600"></canvas>
        <script>
            let ballX = 75;
            let ballSpeedX = 5;
            let ballY = 75;
            let ballSpeedY = 5;
            let canvas, ctx

            const PADDLE_WIDTH = 100;
            const PADDLE_THICKNESS = 10;
            const PADDLE_DIST_FROM_EDGE = 60;
            var paddleX = 400;

            const updateMousePos = (e) => {
                let rect = canvas.getBoundingClientRect();
                let root = document.documentElement;                
                let mouseX = e.clientX - rect.left - root.scrollLeft;
                // let mouseY = e.clientY - rect - root.scrollTop;
                paddleX = mouseX - PADDLE_WIDTH/2;
            }

            window.onload = () => {
                canvas = document.getElementById('gameCanvas');
                ctx = canvas.getContext('2d');

                let framesPerSecond = 30;
                setInterval(updateAll, 1000/framesPerSecond);

                canvas.addEventListener('mousemove', updateMousePos);                
            }

            const updateAll = () => {
                moveAll();
                drawAll();
            }

            const resetBall = () => {
                ballX = canvas.width/2;
                ballY = canvas.height/2;
            }
                
            const moveAll = () => {
                ballX += ballSpeedX;
                ballY += ballSpeedY;
                if (ballX < 0) { // left
                    ballSpeedX *= -1;
                }
                if (ballX > canvas.width) { // right
                    ballSpeedX *= -1;
                }
                if (ballY < 0) { // top
                    ballSpeedY *= -1;
                }
                if (ballY > canvas.height) { // bottom
                    resetBall();
                }

                let paddleLeftEdgeX = paddleX;
                let paddleRightEdgeX = paddleX + PADDLE_WIDTH ;
                let paddleTopEdgeY = canvas.height - PADDLE_DIST_FROM_EDGE;
                let paddleBottomEdgeY = paddleTopEdgeY + PADDLE_THICKNESS;

                if (ballX > paddleLeftEdgeX &&
                    ballX < paddleRightEdgeX && 
                    ballY > paddleTopEdgeY && 
                    ballY < paddleBottomEdgeY) {
                        ballSpeedY *= -1;
                        let centerOfPaddleX = paddleX + PADDLE_WIDTH/2;
                        let ballDistFromPaddleCenterX = ballX - centerOfPaddleX;
                        ballSpeedX = ballDistFromPaddleCenterX * 0.35; 
                    }
            }

            const drawAll = () => {
                colorRect(0, 0, canvas.width, canvas.height, "black"); // canvas
                colorCircle(ballX, ballY, 10, "white"); // pong ball
                colorRect(paddleX, canvas.height - PADDLE_DIST_FROM_EDGE, PADDLE_WIDTH, PADDLE_THICKNESS, "white");
                }
            
            const colorRect = (topLeftX, topLeftY, boxWidth, boxHeight, fillColor) => {
                ctx.fillStyle = fillColor;
                ctx.fillRect(topLeftX, topLeftY, boxWidth, boxHeight);
            }

            const colorCircle = (centerX, centerY, radius, fillColor) => {
                ctx.fillStyle = fillColor;
                ctx.beginPath();
                ctx.arc(centerX, centerY, radius, 0, Math.PI*2);
                ctx.fill();
            }

        </script>
    </body>
</html>